<div class="p-fluid">
    <form [formGroup]="form" (ngSubmit)="save()">
        <div class="field mb-4">
            <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Nome do
                Personagem</label>
            <input id="name" type="text" pInputText formControlName="name" placeholder="Ex: Harry Potter" />
            <small *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="p-error block mt-1">
                Nome é obrigatório (mínimo 2 caracteres).
            </small>
        </div>

        <div class="field mb-4">
            <label for="voiceId" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Voz</label>
            <p-select id="voiceId" [options]="voices" formControlName="voiceId" optionLabel="name" optionValue="id"
                placeholder="Selecione uma voz" [filter]="true" filterBy="name" [showClear]="true" appendTo="body">
                <ng-template pTemplate="selectedItem" let-selectedOption>
                    <div class="flex align-items-center gap-2" *ngIf="selectedOption">
                        <div>{{ selectedOption.name }}</div>
                    </div>
                </ng-template>
                <ng-template pTemplate="item" let-voice>
                    <div class="flex flex-col">
                        <span class="font-medium">{{ voice.name }}</span>
                        <span class="text-xs text-gray-500">{{ voice.gender }} - {{ voice.description }}</span>
                    </div>
                </ng-template>
            </p-select>
            <small *ngIf="form.get('voiceId')?.invalid && form.get('voiceId')?.touched" class="p-error block mt-1">
                Selecione uma voz.
            </small>
        </div>

        <div class="field mb-4" *ngIf="form.get('voiceId')?.value">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Testar Voz
                Selecionada</label>
            <app-voice-preview [voiceId]="form.get('voiceId')?.value"
                [text]="form.get('name')?.value || 'Olá, eu sou ' + (form.get('name')?.value || 'um personagem')">
            </app-voice-preview>
        </div>

        <div class="field mb-6">
            <label for="voiceDescription"
                class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Descrição da Voz
                (Opcional)</label>
            <textarea id="voiceDescription" pInputTextarea formControlName="voiceDescription" rows="3"
                placeholder="Ex: Tom grave, sotaque nordestino, fala pausada...">
            </textarea>
        </div>

        <div class="flex justify-end gap-2">
            <button pButton type="button" label="Cancelar" class="p-button-text" (click)="cancel()"></button>
            <button pButton type="submit" label="Salvar" [disabled]="form.invalid || loading"
                [loading]="loading"></button>
        </div>
    </form>
</div>