<div class="profile-container">
  @if (loading()) {
    <!-- Skeleton -->
    <div class="profile-skeleton">
      <p-skeleton width="100%" height="200px"></p-skeleton>
      <div class="profile-info-skeleton">
        <p-skeleton shape="circle" size="8rem"></p-skeleton>
        <p-skeleton width="200px" height="2rem" class="mt-3"></p-skeleton>
        <p-skeleton width="150px" height="1rem" class="mt-2"></p-skeleton>
      </div>
    </div>
  } @else if (profile(); as p) {
    <!-- Banner -->
    <div class="profile-banner">
      @if (p.banner) {
        <img [src]="p.banner" alt="Banner">
      }
    </div>
    
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="avatar-section">
        <p-avatar 
          [image]="p.avatar || undefined"
          [label]="p.avatar ? undefined : p.displayName.charAt(0)"
          size="xlarge"
          shape="circle"
          styleClass="profile-avatar">
        </p-avatar>
      </div>
      
      <div class="profile-actions">
        @if (p.isOwnProfile) {
          <p-button label="Editar Perfil" severity="secondary" outlined="true"></p-button>
        } @else {
          <p-button 
            [label]="p.isFollowing ? 'Seguindo' : 'Seguir'"
            [severity]="p.isFollowing ? 'secondary' : 'primary'"
            [outlined]="p.isFollowing"
            (onClick)="toggleFollow()">
          </p-button>
          <p-button icon="pi pi-envelope" severity="secondary" outlined="true" [routerLink]="['/social/messages']"></p-button>
        }
      </div>
    </div>
    
    <!-- Profile Info -->
    <div class="profile-info">
      <h1 class="display-name">{{ p.displayName }}</h1>
      <span class="username">&#64;{{ p.username }}</span>
      
      @if (p.bio) {
        <p class="bio">{{ p.bio }}</p>
      }
      
      <div class="meta-info">
        @if (p.location) {
          <span class="meta-item">
            <i class="pi pi-map-marker"></i>
            {{ p.location }}
          </span>
        }
        @if (p.website) {
          <a [href]="p.website" target="_blank" class="meta-item link">
            <i class="pi pi-link"></i>
            {{ p.website }}
          </a>
        }
        <span class="meta-item">
          <i class="pi pi-calendar"></i>
          Entrou em {{ formatDate(p.joinedAt) }}
        </span>
      </div>
      
      <div class="stats">
        <button class="stat-item" (click)="openFollowers()">
          <strong>{{ formatNumber(p.followersCount) }}</strong>
          <span>Seguidores</span>
        </button>
        <button class="stat-item" (click)="openFollowing()">
          <strong>{{ formatNumber(p.followingCount) }}</strong>
          <span>Seguindo</span>
        </button>
        <span class="stat-item">
          <strong>{{ p.postsCount }}</strong>
          <span>Posts</span>
        </span>
        <span class="stat-item">
          <strong>{{ p.booksCount }}</strong>
          <span>Livros</span>
        </span>
      </div>
      
      <!-- Gamification -->
      <div class="gamification-section">
        <div class="level-badge">
          <span class="level-number">{{ p.level }}</span>
          <span class="level-label">Nível</span>
        </div>
        <div class="xp-bar">
          <div class="xp-progress" [style.width.%]="xpProgress()"></div>
        </div>
        <div class="livra-balance">
          <i class="pi pi-wallet"></i>
          <span>{{ formatNumber(p.livraBalance) }} LIVRA</span>
        </div>
      </div>
      
      <!-- Achievements -->
      @if (p.achievements.length > 0) {
        <div class="achievements-section">
          <h3>Conquistas</h3>
          <div class="achievements-list">
            @for (achievement of p.achievements; track achievement.id) {
              <div class="achievement-badge" [title]="achievement.name">
                <i [class]="'pi ' + achievement.icon"></i>
              </div>
            }
          </div>
        </div>
      }
    </div>
    
    <!-- Tabs -->
    <p-tabs value="0">
      <p-tablist>
        <p-tab value="0">Posts</p-tab>
        <p-tab value="1">Livros</p-tab>
        <p-tab value="2">Curtidas</p-tab>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel value="0">
          <div class="posts-list">
            @for (post of posts(); track post.id) {
              <a [routerLink]="['/social/post', post.id]" class="post-item">
                <p class="post-content">{{ post.content }}</p>
                <div class="post-stats">
                  <span><i class="pi pi-heart"></i> {{ post.likesCount }}</span>
                  <span><i class="pi pi-comment"></i> {{ post.commentsCount }}</span>
                </div>
              </a>
            } @empty {
              <div class="empty-posts">
                <p>Nenhum post ainda.</p>
              </div>
            }
          </div>
        </p-tabpanel>
        
        <p-tabpanel value="1">
          <div class="books-placeholder">
            <i class="pi pi-book"></i>
            <p>Livros do autor aparecerão aqui.</p>
          </div>
        </p-tabpanel>
        
        <p-tabpanel value="2">
          <div class="likes-placeholder">
            <i class="pi pi-heart"></i>
            <p>Posts curtidos aparecerão aqui.</p>
          </div>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  }
</div>

<!-- Followers Dialog -->
<p-dialog 
  header="Seguidores" 
  [visible]="showFollowersDialog()" 
  [modal]="true"
  [closable]="true"
  (visibleChange)="showFollowersDialog.set($event)"
  [style]="{width: '400px'}">
  <p>Lista de seguidores...</p>
</p-dialog>

<!-- Following Dialog -->
<p-dialog 
  header="Seguindo" 
  [visible]="showFollowingDialog()" 
  [modal]="true"
  [closable]="true"
  (visibleChange)="showFollowingDialog.set($event)"
  [style]="{width: '400px'}">
  <p>Lista de pessoas que segue...</p>
</p-dialog>
