<p-dialog 
  header="Criar Story" 
  [(visible)]="visible" 
  [modal]="true" 
  [style]="{ width: '90vw', maxWidth: '500px' }"
  [closable]="!creating()"
  (onHide)="onClose()"
>
  <!-- Story Type Selection -->
  <div class="type-selection mb-4">
    <p-selectbutton 
      [options]="storyTypes" 
      [(ngModel)]="selectedType"
      optionLabel="label" 
      optionValue="value"
      [disabled]="creating()"
    />
  </div>

  <!-- Text Story -->
  @if (selectedType === 'TEXT' || selectedType === 'QUOTE') {
    <div class="text-content mb-4">
      <label class="block mb-2 font-medium">
        {{ selectedType === 'QUOTE' ? 'Citação' : 'Texto' }}
      </label>
      <textarea 
        pInputTextarea
        [(ngModel)]="content"
        [rows]="5"
        [placeholder]="selectedType === 'QUOTE' ? 'Digite uma citação inspiradora...' : 'O que você está pensando?'"
        class="w-full"
        [maxlength]="500"
        [disabled]="creating()"
      ></textarea>
      <small class="text-500">{{ content.length }}/500 caracteres</small>
    </div>
  }

  <!-- Image Story -->
  @if (selectedType === 'IMAGE') {
    <div class="image-content mb-4">
      <!-- Hidden file input -->
      <input 
        type="file" 
        #fileInput
        accept="image/jpeg,image/png,image/gif,image/webp"
        (change)="onFileSelected($event)"
        class="hidden-input"
      />

      @if (!imagePreview() && !imageUrl) {
        <div class="upload-area">
          <div class="upload-zone" (click)="triggerFileInput()">
            <i class="pi pi-cloud-upload upload-icon"></i>
            <p class="upload-text">Clique para selecionar uma imagem</p>
            <small class="text-500">JPG, PNG, GIF ou WebP (máx. 5MB)</small>
          </div>
          
          <div class="url-divider">
            <span>ou cole uma URL</span>
          </div>
          
          <input 
            type="text" 
            pInputText 
            [(ngModel)]="imageUrl" 
            placeholder="https://exemplo.com/imagem.jpg"
            class="w-full"
            [disabled]="creating()"
          />
        </div>
      } @else {
        <div class="image-preview">
          <img [src]="imagePreview() || imageUrl" alt="Preview" class="preview-image" />
          <p-button 
            icon="pi pi-times" 
            [rounded]="true" 
            severity="danger"
            size="small"
            (onClick)="removeImage()"
            styleClass="remove-image-btn"
            [disabled]="creating()"
          />
        </div>
        
        <!-- Upload Progress -->
        @if (creating() && uploadProgress() > 0) {
          <div class="upload-progress mt-2">
            <p-progressBar [value]="uploadProgress()" [showValue]="false" />
            <small class="text-500">Enviando imagem...</small>
          </div>
        }
      }

      <div class="caption-input mt-3">
        <label class="block mb-2 font-medium">Legenda (opcional)</label>
        <textarea 
          pInputTextarea
          [(ngModel)]="content"
          [rows]="2"
          placeholder="Adicione uma legenda..."
          class="w-full"
          [maxlength]="200"
          [disabled]="creating()"
        ></textarea>
      </div>
    </div>
  }

  <!-- Error Message -->
  @if (error()) {
    <p-message severity="error" [text]="error()!" styleClass="mb-3 w-full" />
  }

  <!-- Footer Actions -->
  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      [text]="true" 
      (onClick)="onClose()"
      [disabled]="creating()"
    />
    <p-button 
      label="Publicar Story" 
      icon="pi pi-send"
      (onClick)="createStory()"
      [loading]="creating()"
      [disabled]="!isValid()"
    />
  </ng-template>
</p-dialog>
