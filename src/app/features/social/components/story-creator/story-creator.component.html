<p-dialog 
  header="Criar Story" 
  [(visible)]="visible" 
  [modal]="true" 
  [style]="{ width: '90vw', maxWidth: '500px' }"
  [closable]="!creating()"
  (onHide)="onClose()"
>
  <!-- Story Type Selection -->
  <div class="type-selection mb-4">
    <p-selectbutton 
      [options]="storyTypes" 
      [(ngModel)]="selectedType"
      optionLabel="label" 
      optionValue="value"
      [disabled]="creating()"
    />
  </div>

  <!-- Text Story -->
  @if (selectedType === 'TEXT' || selectedType === 'QUOTE') {
    <div class="text-content mb-4">
      <label class="block mb-2 font-medium">
        {{ selectedType === 'QUOTE' ? 'Citação' : 'Texto' }}
      </label>
      <textarea 
        pInputTextarea
        [(ngModel)]="content"
        [rows]="5"
        [placeholder]="selectedType === 'QUOTE' ? 'Digite uma citação inspiradora...' : 'O que você está pensando?'"
        class="w-full"
        [maxlength]="500"
        [disabled]="creating()"
      ></textarea>
      <small class="text-500">{{ content.length }}/500 caracteres</small>
    </div>
  }

  <!-- Image Story -->
  @if (selectedType === 'IMAGE') {
    <div class="image-content mb-4">
      @if (!imageUrl) {
        <div class="upload-area">
          <label class="block mb-2 font-medium">Imagem</label>
          <input 
            type="text" 
            pInputText 
            [(ngModel)]="imageUrl" 
            placeholder="Cole a URL da imagem..."
            class="w-full mb-2"
            [disabled]="creating()"
          />
          <small class="text-500">Suporta URLs de imagens JPG, PNG, GIF</small>
        </div>
      } @else {
        <div class="image-preview">
          <img [src]="imageUrl" alt="Preview" class="preview-image" />
          <p-button 
            icon="pi pi-times" 
            [rounded]="true" 
            severity="danger"
            size="small"
            (onClick)="imageUrl = ''"
            styleClass="remove-image-btn"
          />
        </div>
      }

      <div class="caption-input mt-3">
        <label class="block mb-2 font-medium">Legenda (opcional)</label>
        <textarea 
          pInputTextarea
          [(ngModel)]="content"
          [rows]="2"
          placeholder="Adicione uma legenda..."
          class="w-full"
          [maxlength]="200"
          [disabled]="creating()"
        ></textarea>
      </div>
    </div>
  }

  <!-- Error Message -->
  @if (error()) {
    <p-message severity="error" [text]="error()!" styleClass="mb-3 w-full" />
  }

  <!-- Footer Actions -->
  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      [text]="true" 
      (onClick)="onClose()"
      [disabled]="creating()"
    />
    <p-button 
      label="Publicar Story" 
      icon="pi pi-send"
      (onClick)="createStory()"
      [loading]="creating()"
      [disabled]="!isValid()"
    />
  </ng-template>
</p-dialog>
